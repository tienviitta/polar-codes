"""
The "chk" version: upper_llr(top_llr, btm_llr)

Design SNR: 0.0 dB

test_polar_nopunct.py -M 8 -K 5 

========== Polar Code ==========
N: 8
M: 8
K: 5
Mothercode Construction: bb
Ordered Bits (least reliable to most reliable): [0 4 2 1 6 5 3 7]
Frozen Bits: [2 4 0]
Puncturing Flag: False
Puncturing Parameters: {punct_type: 
                        punct_algorithm: 
                        punct_set: []
                        source_set: []
                        update_frozen_flag: None}
 


The message is: [1 0 0 1 0]
The coded message is: [0 1 1 0 1 0 1 0]
The log-likelihoods are: [ 0.16082923 -2.05397914 -1.45657378  0.55757278  0.02308327  1.96730347 -1.74552562  1.37325182]

Natural order?:
l = [0, 4, 2, 6, 1, 5, 3, 7]

l = 0:
array([[ 0.1608, -0.1242,  0.021 , -0.0001],
       [-2.054 ,     nan,     nan,     nan],
       [-1.4566, -0.3414,     nan,     nan],
       [ 0.5576,     nan,     nan,     nan],
       [ 0.0231,  0.0174, -0.0073,     nan],
       [ 1.9673,     nan,     nan,     nan],
       [-1.7455, -0.8923,     nan,     nan],
       [ 1.3733,     nan,     nan,     nan]])
array([[nan, nan, nan,  0.],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan]])

l = 4:
array([[ 0.1608, -0.1242,  0.021 , -0.0001],
       [-2.054 ,     nan,     nan,     nan],
       [-1.4566, -0.3414,     nan,     nan],
       [ 0.5576,     nan,     nan,     nan],
       [ 0.0231,  0.0174, -0.0073,  0.0137],
       [ 1.9673,     nan,     nan,     nan],
       [-1.7455, -0.8923,     nan,     nan],
       [ 1.3733,     nan,     nan,     nan]])
array([[nan, nan,  0.,  0.],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan,  0.,  0.],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan]])

l = 2:
array([[ 0.1608, -0.1242,  0.021 , -0.0001],
       [-2.054 ,     nan,     nan,     nan],
       [-1.4566, -0.3414, -0.4655,  0.1887],
       [ 0.5576,     nan,     nan,     nan],
       [ 0.0231,  0.0174, -0.0073,  0.0137],
       [ 1.9673,     nan,     nan,     nan],
       [-1.7455, -0.8923, -0.8749,     nan],
       [ 1.3733,     nan,     nan,     nan]])
array([[nan, nan,  0.,  0.],
       [nan, nan, nan, nan],
       [nan, nan, nan,  0.],
       [nan, nan, nan, nan],
       [nan, nan,  0.,  0.],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan]])

l = 6:
array([[ 0.1608, -0.1242,  0.021 , -0.0001],
       [-2.054 ,     nan,     nan,     nan],
       [-1.4566, -0.3414, -0.4655,  0.1887],
       [ 0.5576,     nan,     nan,     nan],
       [ 0.0231,  0.0174, -0.0073,  0.0137],
       [ 1.9673,     nan,     nan,     nan],
       [-1.7455, -0.8923, -0.8749, -1.3404],
       [ 1.3733,     nan,     nan,     nan]])
array([[nan,  1.,  0.,  0.],
       [nan, nan, nan, nan],
       [nan,  1.,  1.,  0.],
       [nan, nan, nan, nan],
       [nan,  1.,  0.,  0.],
       [nan, nan, nan, nan],
       [nan,  1.,  1.,  1.],
       [nan, nan, nan, nan]])

l = 1:
array([[ 0.1608, -0.1242,  0.021 , -0.0001],
       [-2.054 , -2.2148, -1.4308, -0.8986],
       [-1.4566, -0.3414, -0.4655,  0.1887],
       [ 0.5576,  2.0141,     nan,     nan],
       [ 0.0231,  0.0174, -0.0073,  0.0137],
       [ 1.9673,  1.9442,  1.6813,     nan],
       [-1.7455, -0.8923, -0.8749, -1.3404],
       [ 1.3733,  3.1188,     nan,     nan]])
array([[nan,  1.,  0.,  0.],
       [nan, nan, nan,  1.],
       [nan,  1.,  1.,  0.],
       [nan, nan, nan, nan],
       [nan,  1.,  0.,  0.],
       [nan, nan, nan, nan],
       [nan,  1.,  1.,  1.],
       [nan, nan, nan, nan]])

l = 5:
array([[ 0.1608, -0.1242,  0.021 , -0.0001],
       [-2.054 , -2.2148, -1.4308, -0.8986],
       [-1.4566, -0.3414, -0.4655,  0.1887],
       [ 0.5576,  2.0141,     nan,     nan],
       [ 0.0231,  0.0174, -0.0073,  0.0137],
       [ 1.9673,  1.9442,  1.6813,  3.1121],
       [-1.7455, -0.8923, -0.8749, -1.3404],
       [ 1.3733,  3.1188,     nan,     nan]])
array([[nan,  1.,  0.,  0.],
       [nan, nan,  1.,  1.],
       [nan,  1.,  1.,  0.],
       [nan, nan, nan, nan],
       [nan,  1.,  0.,  0.],
       [nan, nan,  0.,  0.],
       [nan,  1.,  1.,  1.],
       [nan, nan, nan, nan]])

l = 3:
array([[ 0.1608, -0.1242,  0.021 , -0.0001],
       [-2.054 , -2.2148, -1.4308, -0.8986],
       [-1.4566, -0.3414, -0.4655,  0.1887],
       [ 0.5576,  2.0141,  4.229 ,  3.8684],
       [ 0.0231,  0.0174, -0.0073,  0.0137],
       [ 1.9673,  1.9442,  1.6813,  3.1121],
       [-1.7455, -0.8923, -0.8749, -1.3404],
       [ 1.3733,  3.1188,  5.063 ,     nan]])
array([[nan,  1.,  0.,  0.],
       [nan, nan,  1.,  1.],
       [nan,  1.,  1.,  0.],
       [nan, nan, nan,  0.],
       [nan,  1.,  0.,  0.],
       [nan, nan,  0.,  0.],
       [nan,  1.,  1.,  1.],
       [nan, nan, nan, nan]])

l = 7:
array([[ 0.1608, -0.1242,  0.021 , -0.0001],
       [-2.054 , -2.2148, -1.4308, -0.8986],
       [-1.4566, -0.3414, -0.4655,  0.1887],
       [ 0.5576,  2.0141,  4.229 ,  3.8684],
       [ 0.0231,  0.0174, -0.0073,  0.0137],
       [ 1.9673,  1.9442,  1.6813,  3.1121],
       [-1.7455, -0.8923, -0.8749, -1.3404],
       [ 1.3733,  3.1188,  5.063 ,  9.292 ]])
array([[0., 1., 0., 0.],
       [1., 1., 1., 1.],
       [1., 1., 1., 0.],
       [0., 0., 0., 0.],
       [1., 1., 0., 0.],
       [0., 0., 0., 0.],
       [1., 1., 1., 1.],
       [0., 0., 0., 0.]])

self.x_noisy: array([0, 1, 0, 0, 0, 0, 1, 0])

myPC.message_received: array([1, 0, 0, 1, 0])

The decoded message is: [1 0 0 1 0]
PASS: True

"""

"""
The "f_-(\alpha, \beta)" approximation: upper_llr_approx(top_llr, btm_llr)

Design SNR: 0.0 dB

test_polar_nopunct.py -M 8 -K 5 

========== Polar Code ==========
N: 8
M: 8
K: 5

Ordered Bits (least reliable to most reliable): [0 4 2 1 6 5 3 7]
Frozen Bits: [2 4 0]

The message is: [1 0 0 1 0]
The coded message is: [0 1 1 0 1 0 1 0]
The log-likelihoods are: [ 0.1608 -2.054  -1.4566  0.5576  0.0231  1.9673 -1.7455  1.3733]

Order: l = [0, 4, 2, 6, 1, 5, 3, 7]

l = 0:
LLR = [[ 0.1608, -0.1608,  0.1608, -0.0231],
       [-2.054 ,     nan,     nan,     nan],
       [-1.4566, -0.5576,     nan,     nan],
       [ 0.5576,     nan,     nan,     nan],
       [ 0.0231,  0.0231, -0.0231,     nan],
       [ 1.9673,     nan,     nan,     nan],
       [-1.7455, -1.3733,     nan,     nan],
       [ 1.3733,     nan,     nan,     nan]])
BIT = [[nan, nan, nan,  0.],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan]])

l = 4:
LLR = [[ 0.1608, -0.1608,  0.1608, -0.0231],
       [-2.054 ,     nan,     nan,     nan],
       [-1.4566, -0.5576,     nan,     nan],
       [ 0.5576,     nan,     nan,     nan],
       [ 0.0231,  0.0231, -0.0231,  0.1377],
       [ 1.9673,     nan,     nan,     nan],
       [-1.7455, -1.3733,     nan,     nan],
       [ 1.3733,     nan,     nan,     nan]])
BIT = [[nan, nan,  0.,  0.],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan,  0.,  0.],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan]])

l = 2:
LLR = [[ 0.1608, -0.1608,  0.1608, -0.0231],
       [-2.054 ,     nan,     nan,     nan],
       [-1.4566, -0.5576, -0.7184,  0.7184],
       [ 0.5576,     nan,     nan,     nan],
       [ 0.0231,  0.0231, -0.0231,  0.1377],
       [ 1.9673,     nan,     nan,     nan],
       [-1.7455, -1.3733, -1.3502,     nan],
       [ 1.3733,     nan,     nan,     nan]])
BIT = [[nan, nan,  0.,  0.],
       [nan, nan, nan, nan],
       [nan, nan, nan,  0.],
       [nan, nan, nan, nan],
       [nan, nan,  0.,  0.],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan],
       [nan, nan, nan, nan]])

l = 6:
LLR = [[ 0.1608, -0.1608,  0.1608, -0.0231],
       [-2.054 ,     nan,     nan,     nan],
       [-1.4566, -0.5576, -0.7184,  0.7184],
       [ 0.5576,     nan,     nan,     nan],
       [ 0.0231,  0.0231, -0.0231,  0.1377],
       [ 1.9673,     nan,     nan,     nan],
       [-1.7455, -1.3733, -1.3502, -2.0686],
       [ 1.3733,     nan,     nan,     nan]])
BIT = [[nan,  1.,  0.,  0.],
       [nan, nan, nan, nan],
       [nan,  1.,  1.,  0.],
       [nan, nan, nan, nan],
       [nan,  1.,  0.,  0.],
       [nan, nan, nan, nan],
       [nan,  1.,  1.,  1.],
       [nan, nan, nan, nan]])

l = 1:
LLR = [[ 0.1608, -0.1608,  0.1608, -0.0231],
       [-2.054 , -2.2148, -2.0141, -1.9442],
       [-1.4566, -0.5576, -0.7184,  0.7184],
       [ 0.5576,  2.0141,     nan,     nan],
       [ 0.0231,  0.0231, -0.0231,  0.1377],
       [ 1.9673,  1.9442,  1.9442,     nan],
       [-1.7455, -1.3733, -1.3502, -2.0686],
       [ 1.3733,  3.1188,     nan,     nan]])
BIT = [[nan,  1.,  0.,  0.],
       [nan, nan, nan,  1.],
       [nan,  1.,  1.,  0.],
       [nan, nan, nan, nan],
       [nan,  1.,  0.,  0.],
       [nan, nan, nan, nan],
       [nan,  1.,  1.,  1.],
       [nan, nan, nan, nan]])

l = 5:
LLR = [[ 0.1608, -0.1608,  0.1608, -0.0231],
       [-2.054 , -2.2148, -2.0141, -1.9442],
       [-1.4566, -0.5576, -0.7184,  0.7184],
       [ 0.5576,  2.0141,     nan,     nan],
       [ 0.0231,  0.0231, -0.0231,  0.1377],
       [ 1.9673,  1.9442,  1.9442,  3.9584],
       [-1.7455, -1.3733, -1.3502, -2.0686],
       [ 1.3733,  3.1188,     nan,     nan]])
BIT = [[nan,  1.,  0.,  0.],
       [nan, nan,  1.,  1.],
       [nan,  1.,  1.,  0.],
       [nan, nan, nan, nan],
       [nan,  1.,  0.,  0.],
       [nan, nan,  0.,  0.],
       [nan,  1.,  1.,  1.],
       [nan, nan, nan, nan]])

l = 3:
LLR = [[ 0.1608, -0.1608,  0.1608, -0.0231],
       [-2.054 , -2.2148, -2.0141, -1.9442],
       [-1.4566, -0.5576, -0.7184,  0.7184],
       [ 0.5576,  2.0141,  4.229 ,  4.229 ],
       [ 0.0231,  0.0231, -0.0231,  0.1377],
       [ 1.9673,  1.9442,  1.9442,  3.9584],
       [-1.7455, -1.3733, -1.3502, -2.0686],
       [ 1.3733,  3.1188,  5.063 ,     nan]])
BIT = [[nan,  1.,  0.,  0.],
       [nan, nan,  1.,  1.],
       [nan,  1.,  1.,  0.],
       [nan, nan, nan,  0.],
       [nan,  1.,  0.,  0.],
       [nan, nan,  0.,  0.],
       [nan,  1.,  1.,  1.],
       [nan, nan, nan, nan]])

l = 7:
LLR = [[ 0.1608, -0.1608,  0.1608, -0.0231],
       [-2.054 , -2.2148, -2.0141, -1.9442],
       [-1.4566, -0.5576, -0.7184,  0.7184],
       [ 0.5576,  2.0141,  4.229 ,  4.229 ],
       [ 0.0231,  0.0231, -0.0231,  0.1377],
       [ 1.9673,  1.9442,  1.9442,  3.9584],
       [-1.7455, -1.3733, -1.3502, -2.0686],
       [ 1.3733,  3.1188,  5.063 ,  9.292 ]])
BIT = [[0., 1., 0., 0.],
       [1., 1., 1., 1.],
       [1., 1., 1., 0.],
       [0., 0., 0., 0.],
       [1., 1., 0., 0.],
       [0., 0., 0., 0.],
       [1., 1., 1., 1.],
       [0., 0., 0., 0.]])

x: array([0, 1, 0, 0, 0, 0, 1, 0])

mmsg: array([1, 0, 0, 1, 0])

The decoded message is: [1 0 0 1 0]
PASS: True

"""

"""

debug> dec2bin(0:63)
ans =

    0    000000    000000     0    
    1    000001    100000    32    
    2    000010    010000    16    
    3    000011    110000    48    
    4    000100    001000     8    
    5    000101    101000    40    
    6    000110    011000    24    
    7    000111    111000    56    
    8    001000    000100     4    
    9    001001    100100    36    
   10    001010    010100    20    
   11    001011    110100    52    
   12    001100    001100    12    
   13    001101    101100    44    
   14    001110    011100    28    
   15    001111    111100    60    
   16    010000    000010     2    
   17    010001    100010    34    
   18    010010    010010    18    
   19    010011    110010    50    
   20    010100    001010    10    
   21    010101    101010    42    
   22    010110    011010    26    
   23    010111    111010    58    
   24    011000    000110     6    
   25    011001    100110    38    
   26    011010    010110    22    
   27    011011    110110    54    
   28    011100    001110    14    
   29    011101    101110    46    
   30    011110    011110    30    
   31    011111    111110    62    
   32    100000    000001     1    
   33    100001    100001    33    
   34    100010    010001    17    
   35    100011    110001    49    
   36    100100    001001     9    
   37    100101    101001    41    
   38    100110    011001    25    
   39    100111    111001    57    
   40    101000    000101     5    
   41    101001    100101    37    
   42    101010    010101    21    
   43    101011    110101    53    
   44    101100    001101    13    
   45    101101    101101    45    
   46    101110    011101    29    
   47    101111    111101    61    
   48    110000    000011     3    
   49    110001    100011    35    
   50    110010    010011    19    
   51    110011    110011    51    
   52    110100    001011    11    
   53    110101    101011    43    
   54    110110    011011    27    
   55    110111    111011    59    
   56    111000    000111     7    
   57    111001    100111    39    
   58    111010    010111    23    
   59    111011    110111    55    
   60    111100    001111    15    
   61    111101    101111    47    
   62    111110    011111    31    
   63    111111    111111    63    

llrs =

   42.0320   54.6237   61.9664  -63.9865  -63.9865   63.9865   77.0211
         0   42.0320   49.8065  -49.8065   49.8065   49.8065   65.8458
         0         0   54.6237  -54.6237  -59.3189   70.5808  -71.8363
         0         0   42.0320  -65.7106  -70.3572   70.3572  -73.0364
         0         0         0  -61.9664  -61.9664  -61.9664   67.9582
         0         0         0  -52.4853  -52.4853   52.4853   52.4853
         0         0         0  -56.7513  -56.7513   56.7513   56.7513
         0         0         0  -42.0320   52.9941  -52.9941   52.9941
         0         0         0         0   64.0699  -64.0699  -68.9209
         0         0         0         0  -51.7757  -51.7757   74.7909
         0         0         0         0   54.6237  -54.6237   57.1616
         0         0         0         0   65.7106  -80.7070   84.3766
         0         0         0         0   65.3518   70.0175   70.0175
         0         0         0         0   62.0448  -62.0448   62.0448
         0         0         0         0   62.2845  -62.2845  -62.7677
         0         0         0         0  -42.0320   42.0320   42.0320
         0         0         0         0         0  -65.3137  -65.3137
         0         0         0         0         0   84.2415   84.2415
         0         0         0         0         0  -59.3189  -59.3189
         0         0         0         0         0  -76.8016  -76.8016
         0         0         0         0         0   64.4147   64.4147
         0         0         0         0         0  -67.4293  -67.4293
         0         0         0         0         0  -68.5642  -68.5642
         0         0         0         0         0  -72.0694  -72.0694
         0         0         0         0         0  -70.7300  -70.7300
         0         0         0         0         0   74.8860   74.8860
         0         0         0         0         0  -71.7620  -71.7620
         0         0         0         0         0  -65.7106  -65.7106
         0         0         0         0         0   65.3518   65.3518
         0         0         0         0         0  -78.0044  -78.0044
         0         0         0         0         0  -69.2300  -69.2300
         0         0         0         0         0  -64.0146  -64.0146
         0         0         0         0         0         0   63.9865
         0         0         0         0         0         0   49.8065
         0         0         0         0         0         0  -70.5808
         0         0         0         0         0         0  -70.3572
         0         0         0         0         0         0  -61.9664
         0         0         0         0         0         0   67.5113
         0         0         0         0         0         0   79.3467
         0         0         0         0         0         0  -59.8898
         0         0         0         0         0         0   64.0699
         0         0         0         0         0         0  -51.7757
         0         0         0         0         0         0  -54.6237
         0         0         0         0         0         0  -80.7070
         0         0         0         0         0         0   71.9740
         0         0         0         0         0         0  -78.9895
         0         0         0         0         0         0   62.2845
         0         0         0         0         0         0   63.4942
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         0         0         0         0         0         0       Inf
         
"""
...
